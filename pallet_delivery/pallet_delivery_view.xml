<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
    <!-- Purchase Order -->
    <record id="purchase_order_hidden" model="ir.actions.act_window">
      <field name="name">Purchase Orders</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">purchase.order</field>
      <field name="view_mode">tree,form,graph,calendar</field>
      <field name="context">{}</field>
      <field name="domain">['&amp;', ('state','not in',('draft','sent','confirmed')), ('hidden', '!=', True)]</field>
      <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">
          Click to create a quotation that will be converted into a purchase order. 
        </p><p>
          Use this menu to search within your purchase orders by
          references, supplier, products, etc. For each purchase order,
          you can track the related discussion with the supplier, control
          the products received and control the supplier invoices.
        </p>
      </field>
    </record>

    <menuitem
      id="purchase.menu_purchase_form_action"
      action="purchase_order_hidden"
      parent="purchase.menu_procurement_management"
      sequence="6" />

    <!-- Truck -->
    <record id="truck_tree" model="ir.ui.view">
      <field name="name">stock.truck.tree</field>
      <field name="model">stock.truck</field>
      <field name="arch" type="xml">
        <tree string="Truck">
          <field name="name" />
          <field name="truck_sn" />
          <field name="supplier" />
          <field name="arrival" />
        </tree>
      </field>
    </record>

    <record id="truck_form" model="ir.ui.view">
      <field name="name">stock.truck.form</field>
      <field name="model">stock.truck</field>
      <field eval="1" name="priority" />
      <field name="arch" type="xml">
        <form string="Truck" version="7.0">
          <header>
            <button
              name="action_done"
              type="object"
              states="draft"
              string="Confirm"
              class="oe_highlight" />

            <field
              name="state"
              widget="statusbar"
              statusbar_visible="draft,done"
              statusbar_colors='{"draft":"blue","done":"blue"}' />
          </header>

          <sheet>
            <group>
              <group name="pedigree" string="Details" colspan="4" col="4">
                <group>
                  <field name="truck_sn" />
                  <field name="supplier" />
                  <field name="arrival" on_change="onchange_arrival(arrival)" />
                </group>

                <group>
                  <field name="front_temperature" on_change="validate_temperature(front_temperature, 'front_temperature')" />
                  <field name="back_temperature" on_change="validate_temperature(back_temperature, 'back_temperature')" />
                </group>
              </group>

              <group name="purchase_orders" string="Purchase Orders" colspan="4">
                <field name="purchase_order_ids" nolabel="1" domain="[('state', 'not in', ['draft', 'done']), ('assigned', '=', True)]">
                  <tree>
                    <field name="name" />
                  </tree>
                </field>
              </group>

              <group name="pallets" string="Truck Composition" colspan="4">
                <group>
                  <field name="left_pallet_ids" nolabel="1">
                    <tree editable="bottom">
                      <field name="pallet" string="Left Pallets" context="{'nice':'nice','parent':parent}" />
                      <field name="crates" string="Crates" />
                    </tree>
                  </field>
                </group>

                <group>
                  <field name="right_pallet_ids" nolabel="1">
                    <tree editable="bottom">
                      <field name="pallet" string="Right Pallets" context="{'nice':'nice','parent':parent}" />
                      <field name="crates" string="Crates" />
                    </tree>
                  </field>
                </group>
              </group>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <record id="view_truck_filter" model="ir.ui.view">
      <field name="name">stock.truck.select</field>
      <field name="model">stock.truck</field>
      <field name="arch" type="xml">
        <search string="Search Truck">
          <field name="truck_sn" string="Serial Number" filter_domain="[('truck_sn', '=', self)]" />
        </search>
      </field>
    </record>

    <!-- Menu -->
    <record id="action_truck_pending" model="ir.actions.act_window">
      <field name="name">On Draft Truck</field>
      <field name="res_model">stock.truck</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
      <field eval="False" name="view_id" />
      <field name="search_view_id" ref="pallet_delivery.view_truck_filter" />
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">Click to create a draft truck</p>

        <p>The truck contains an incoming, physical shipment. With it you can
          register the truck's details, such as its serial number, sampled
          temperatures, and other information. Also, the truck serves you as a
          map of what your company received.</p>

        <p>When you confirm the truck, it will act as an “Incoming Shipment”
          confirmation, and the products will be moved from your Suppliers (as
          listed in Purchase Orders) to your Stock.</p>
      </field>
    </record>

    <menuitem
      name="Incoming Truck"
      id="menu_truck_purchase"
      action="action_truck_pending"
      parent="purchase.menu_procurement_management_inventory"
      sequence="8" />

    <menuitem
      name="Incoming Truck"
      id="menu_truck_stock"
      action="action_truck_pending"
      parent="stock.menu_stock_warehouse_mgmt"
      sequence="0" />
  </data>
</openerp>
